# マップサイズ拡張の移行手順

このドキュメントでは、島のマップサイズを20×20から24×24に拡張する際の手順を説明します。

## 概要

- **旧サイズ**: 20×20
- **新サイズ**: 24×24
- **影響**: 既存の島データを安全に拡張します

## 重要な注意事項

⚠️ **必ずバックアップを取ってから実行してください**

移行スクリプトは自動的にバックアップを作成しますが、念のため手動でもバックアップを取ることを強く推奨します。

## 移行手順

### 1. 事前準備

```bash
# データディレクトリの手動バックアップ（推奨）
cp -r logs/data logs/data_manual_backup_$(date +%Y%m%d_%H%M%S)
```

### 2. 移行スクリプトの実行

```bash
php migrate-island-size.php
```

スクリプトは以下の処理を行います：

1. `logs/data` ディレクトリ内のすべてのファイルを自動バックアップ
2. `island.*` ファイルを検出
3. 各島データを20×20から24×24形式に変換
4. 既存のマップデータは中央に配置され、周囲は海で埋められます

### 3. 動作確認

移行後、以下を確認してください：

- [ ] ゲームが正常に起動すること
- [ ] 既存の島が正しく表示されること
- [ ] 島のデータ（建物、地形など）が保持されていること
- [ ] 新しく作成した島が24×24で作成されること

### 4. トラブルシューティング

問題が発生した場合：

```bash
# 1. バックアップから復元
rm -rf logs/data
cp -r logs/data_backup_[タイムスタンプ] logs/data

# 2. または手動バックアップから復元
rm -rf logs/data
cp -r logs/data_manual_backup_[タイムスタンプ] logs/data
```

## 技術的な詳細

### マップデータの配置

旧データは新マップの中央に配置されます：

```
新マップ（24×24）:
┌────────────────────────┐
│  海海海...（2行）      │
│  海┌──────────┐海     │
│  海│          │海     │
│  海│ 旧データ │海     │ ← 旧20×20データ
│  海│ (20×20)  │海     │
│  海│          │海     │
│  海└──────────┘海     │
│  海海海...（2行）      │
└────────────────────────┘
     ↑
   オフセット2マス
```

### ファイル形式

島データファイル（`island.{id}`）の形式：

- **地形データ**: 各タイルが7文字（地形コード2桁hex + 地形値5桁hex）
- **コマンドデータ**: CSV形式（移行時は変更なし）

## 新機能の恩恵

マップ拡張により：

- 建設可能な面積が増加（400 → 576マス）
- より複雑な島の設計が可能
- 戦略的な配置の選択肢が増加

## サポート

問題が発生した場合は、GitHubのIssuesで報告してください：
https://github.com/Sotalbireo/hakoniwa/issues
